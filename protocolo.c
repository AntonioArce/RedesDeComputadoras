#include<stdio.h>
#include<stdlib.h>
#include<string.h>
void analizador(unsigned char *T);

int main(void)
{
	unsigned short int i=0,j;
	unsigned char Trama[][193]={
		{
        0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x23, /* .......# */
        0x8b, 0x46, 0xe9, 0xad, 0x08, 0x06, 0x00, 0x04, /* .F...... */
        0x08, 0x00, 0x06, 0x04, 0x00, 0x01, 0x00, 0x23, /* .......# */
        0x8b, 0x46, 0xe9, 0xad, 0x94, 0xcc, 0x39, 0xcb, /* .F....9. */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x94, 0xcc, /* ........ */
        0x39, 0xfe                                      /* 9. */
        },

        {
        0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x00, 0x1f, /* .#.F.... */
        0x45, 0x9d, 0x1e, 0xa2, 0x08, 0x06, 0x00, 0x01, /* E....... */
        0x08, 0x00, 0x06, 0x04, 0x00, 0x02, 0x00, 0x1f, /* ........ */
        0x45, 0x9d, 0x1e, 0xa2, 0x94, 0xcc, 0x39, 0xfe, /* E.....9. */
        0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x94, 0xcc, /* .#.F.... */
        0x39, 0xcb, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 9....... */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* ........ */
        0x00, 0x00, 0x00, 0x00                          /* .... */
        },
        {
        0x00, 0x1f, 0x45, 0x9d, 0x1e, 0xa2, 0x00, 0x23, /* ..E....# */
        0x8b, 0x46, 0xe9, 0xad, 0x08, 0x00, 0x46, 0x00, /* .F....F. */
        0x80, 0x42, 0x04, 0x55, 0x34, 0x11, 0x80, 0x11, /* .B.U4... */
        0x6b, 0xf0, 0x94, 0xcc, 0x39, 0xcb, 0x94, 0xcc, /* k...9... */
        0x67, 0x02, 0xaa, 0xbb, 0xcc, 0xdd, 0x04, 0x0c, /* g....... */
        0x00, 0x35, 0x00, 0x2e, 0x85, 0x7c, 0xe2, 0x1a, /* .5...|.. */
        0x01, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, /* ........ */
        0x00, 0x00, 0x03, 0x77, 0x77, 0x77, 0x03, 0x69, /* ...www.i */
        0x73, 0x63, 0x05, 0x65, 0x73, 0x63, 0x6f, 0x6d, /* sc.escom */
        0x03, 0x69, 0x70, 0x6e, 0x02, 0x6d, 0x78, 0x00, /* .ipn.mx. */
        0x00, 0x1c, 0x00, 0x01                          /* .... */
        },
        {
        0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x02, /* ........ */
        0xb3, 0x9c, 0xae, 0xba, 0x00, 0x04, 0xf0, 0xf1, /* ........ */
        0x09, 0x8d, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* ........ */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* ........ */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* ........ */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* ........ */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* ........ */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0x9b, 0x6d  /* .....|.m */
        },
        {
        0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x23, /* .......# */
        0x8b, 0x46, 0xe9, 0xad, 0x08, 0x06, 0x00, 0x10, /* .F...... */
        0x08, 0x00, 0x06, 0x04, 0x00, 0x03, 0x00, 0x23, /* .......# */
        0x8b, 0x46, 0xe9, 0xad, 0x94, 0xcc, 0x39, 0xcb, /* .F....9. */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x94, 0xcc, /* ........ */
        0x3a, 0xe1                                      /* :. */
        },
        {
        0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x00, 0x1f, /* .#.F.... */
        0x45, 0x9d, 0x1e, 0xa2, 0x08, 0x06, 0x00, 0x10, /* E....... */
        0x08, 0x00, 0x06, 0x04, 0x00, 0x04, 0x00, 0x1f, /* ........ */
        0x45, 0x9d, 0x1e, 0xa2, 0x94, 0xcc, 0x3a, 0xe1, /* E.....:. */
        0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x94, 0xcc, /* .#.F.... */
        0x39, 0xcb, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 9....... */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* ........ */
        0x00, 0x00, 0x00, 0x00                          /* .... */
        },
        {
        0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x00, 0x1f, /* .#.F.... */
        0x45, 0x9d, 0x1e, 0xa2, 0x08, 0x00, 0x45, 0x00, /* E.....E. */
        0x00, 0x6f, 0x90, 0x30, 0x40, 0x00, 0xfb, 0x11, /* .o.0@... */
        0x24, 0xe7, 0x94, 0xcc, 0x67, 0x02, 0x94, 0xcc, /* $...g... */
        0x39, 0xcb, 0x00, 0x35, 0x04, 0x0c, 0x00, 0x5b, /* 9..5...[ */
        0xe8, 0x60, 0xe2, 0x1a, 0x85, 0x80, 0x00, 0x01, /* .`...... */
        0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x03, 0x77, /* .......w */
        0x77, 0x77, 0x03, 0x69, 0x73, 0x63, 0x05, 0x65, /* ww.isc.e */
        0x73, 0x63, 0x6f, 0x6d, 0x03, 0x69, 0x70, 0x6e, /* scom.ipn */
        0x02, 0x6d, 0x78, 0x00, 0x00, 0x1c, 0x00, 0x01, /* .mx..... */
        0xc0, 0x14, 0x00, 0x06, 0x00, 0x01, 0x00, 0x00, /* ........ */
        0x0e, 0x10, 0x00, 0x21, 0x04, 0x64, 0x6e, 0x73, /* ...!.dns */
        0x31, 0xc0, 0x1a, 0x03, 0x74, 0x69, 0x63, 0xc0, /* 1...tic. */
        0x1a, 0x77, 0xec, 0xdf, 0x29, 0x00, 0x00, 0x2a, /* .w..)..* */
        0x30, 0x00, 0x00, 0x0e, 0x10, 0x00, 0x12, 0x75, /* 0......u */
        0x00, 0x00, 0x00, 0x2a, 0x30                    /* ...*0 */
        },
        {
        0x00, 0x1f, 0x45, 0x9d, 0x1e, 0xa2, 0x00, 0x23, /* ..E....# */
        0x8b, 0x46, 0xe9, 0xad, 0x08, 0x00, 0x45, 0x00, /* .F....E. */
        0x00, 0x42, 0x04, 0x56, 0x00, 0x00, 0x80, 0x11, /* .B.V.... */
        0x6b, 0xef, 0x94, 0xcc, 0x39, 0xcb, 0x94, 0xcc, /* k...9... */
        0x67, 0x02, 0x04, 0x0c, 0x00, 0x35, 0x00, 0x2e, /* g....5.. */
        0xff, 0x87, 0x68, 0x2a, 0x01, 0x00, 0x00, 0x01, /* ..h*.... */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x77, /* .......w */
        0x77, 0x77, 0x03, 0x69, 0x73, 0x63, 0x05, 0x65, /* ww.isc.e */
        0x73, 0x63, 0x6f, 0x6d, 0x03, 0x69, 0x70, 0x6e, /* scom.ipn */
        0x02, 0x6d, 0x78, 0x00, 0x00, 0x01, 0x00, 0x01  /* .mx..... */
        },
        {
        0x00, 0x1f, 0x45, 0x9d, 0x1e, 0xa2, 0x00, 0x23, /* ..E....# */
        0x8b, 0x46, 0xe9, 0xad, 0x08, 0x00, 0x45, 0x00, /* .F....E. */
        0x00, 0x3c, 0x04, 0x57, 0x00, 0x00, 0x80, 0x01, /* .<.W.... */
        0x98, 0x25, 0x94, 0xcc, 0x39, 0xcb, 0x94, 0xcc, /* .%..9... */
        0x3a, 0xe1, 0x08, 0x00, 0x49, 0x5c, 0x03, 0x00, /* :...I\.. */
        0x01, 0x00, 0x61, 0x62, 0x63, 0x64, 0x65, 0x66, /* ..abcdef */
        0x67, 0x68, 0x69, 0x6a, 0x6b, 0x6c, 0x6d, 0x6e, /* ghijklmn */
        0x6f, 0x70, 0x71, 0x72, 0x73, 0x74, 0x75, 0x76, /* opqrstuv */
        0x77, 0x61, 0x62, 0x63, 0x64, 0x65, 0x66, 0x67, /* wabcdefg */
        0x68, 0x69                                      /* hi */
        },
        {
        0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x00, 0x1f, /* .#.F.... */
        0x45, 0x9d, 0x1e, 0xa2, 0x08, 0x00, 0x45, 0x00, /* E.....E. */
        0x00, 0x3c, 0x01, 0xb5, 0x00, 0x00, 0x3f, 0x01, /* .<....?. */
        0xdb, 0xc7, 0x94, 0xcc, 0x3a, 0xe1, 0x94, 0xcc, /* ....:... */
        0x39, 0xcb, 0x00, 0x00, 0x51, 0x5c, 0x03, 0x00, /* 9...Q\.. */
        0x01, 0x00, 0x61, 0x62, 0x63, 0x64, 0x65, 0x66, /* ..abcdef */
        0x67, 0x68, 0x69, 0x6a, 0x6b, 0x6c, 0x6d, 0x6e, /* ghijklmn */
        0x6f, 0x70, 0x71, 0x72, 0x73, 0x74, 0x75, 0x76, /* opqrstuv */
        0x77, 0x61, 0x62, 0x63, 0x64, 0x65, 0x66, 0x67, /* wabcdefg */
        0x68, 0x69                                      /* hi */
        },
        {
        0x00, 0x1f, 0x45, 0x9d, 0x1e, 0xa2, 0x00, 0x1c, /* ..E..... */
        0xc0, 0x7b, 0x35, 0xa1, 0x08, 0x00, 0x48, 0x00, /* .{5...H. */
        0x00, 0x48, 0x5c, 0x7d, 0x00, 0x00, 0x80, 0x01, /* .H\}.... */
        0x6c, 0x88, 0x94, 0xcc, 0x39, 0xc3, 0x94, 0xcc, /* l...9... */
        0x00, 0x49, 0x07, 0x0b, 0x04, 0x00, 0x00, 0x00, /* .I...... */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, /* ........ */
        0x3b, 0x5c, 0x02, 0x00, 0x10, 0x00, 0x61, 0x62, /* ;\....ab */
        0x63, 0x64, 0x65, 0x66, 0x67, 0x68, 0x69, 0x6a, /* cdefghij */
        0x6b, 0x6c, 0x6d, 0x6e, 0x6f, 0x70, 0x71, 0x72, /* klmnopqr */
        0x73, 0x74, 0x75, 0x76, 0x77, 0x61, 0x62, 0x63, /* stuvwabc */
        0x64, 0x65, 0x66, 0x67, 0x68, 0x69              /* defghi */
        },
        {
        0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x00, 0x1f, /* .#.F.... */
        0x45, 0x9d, 0x1e, 0xa2, 0x80, 0x35, 0x00, 0x01, /* E....5.. */
        0x08, 0x00, 0x06, 0x04, 0x00, 0x03, 0x00, 0x1f, /* ........ */
        0x45, 0x9d, 0x1e, 0xa2, 0x94, 0xcc, 0x3a, 0xe1, /* E.....:. */
        0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x94, 0xcc, /* .#.F.... */
        0x39, 0xcb, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 9....... */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* ........ */
        0x00, 0x00, 0x00, 0x00, 0xd8, 0xee, 0xdf, 0xb0  /* ........ */
        },
        {
        0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x02, /* ........ */
        0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x03, 0xf0, 0xf0, /* ........ */
        0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* ........ */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* ........ */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* ........ */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* ........ */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* ........ */
        0x00, 0x00, 0x00, 0x00, 0x43, 0x05, 0x90, 0x6d  /* ....C..m */
        },
        {
        0x02, 0xff, 0x53, 0xc3, 0xe9, 0xab, 0x00, 0xff, /* ..S..... */
        0x66, 0x7f, 0xd4, 0x3c, 0x08, 0x00, 0x45, 0x00, /* f..<..E. */
        0x00, 0x30, 0x2c, 0x00, 0x40, 0x00, 0x80, 0x06, /* .0,.@... */
        0x4b, 0x74, 0xc0, 0xa8, 0x01, 0x02, 0xc0, 0xa8, /* Kt...... */
        0x01, 0x01, 0x04, 0x03, 0x00, 0x15, 0x00, 0x3b, /* .......; */
        0xcf, 0x44, 0x00, 0x00, 0x00, 0x00, 0x50, 0x20, /* .D....p  */
        0x20, 0x00, 0x0c, 0x34, 0x00, 0x00, 0x02, 0x04, /*  ..4.... */
        0x05, 0xb4, 0x01, 0x01, 0x04, 0x02              /* ...... */
        },
        {
        0x00, 0xff, 0x66, 0x7f, 0xd4, 0x3c, 0x02, 0xff, /* ..f..<.. */
        0x53, 0xc3, 0xe9, 0xab, 0x08, 0x00, 0x45, 0x00, /* S.....E. */
        0x00, 0x30, 0x05, 0xc4, 0x40, 0x00, 0x80, 0x06, /* .0..@... */
        0x71, 0xb0, 0xc0, 0xa8, 0x01, 0x01, 0xc0, 0xa8, /* q....... */
        0x01, 0x02, 0x00, 0x15, 0x04, 0x03, 0x21, 0x5d, /* ......!] */
        0x3a, 0x44, 0x00, 0x3b, 0xcf, 0x45, 0x70, 0x12, /* :D.;.Ep. */
        0x44, 0x70, 0x8c, 0x11, 0x00, 0x00, 0x02, 0x04, /* Dp...... */
        0x05, 0xb4, 0x01, 0x01, 0x04, 0x02              /* ...... */
        },
        {
        0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x02, /* ........ */
        0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x12, 0xf0, 0xf0, /* ........ */
        0x0a, 0x0b, 0x0e, 0x00, 0xff, 0xef, 0x14, 0x00, /* ........ */
        0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x7f, 0x23, /* ..(....# */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* ........ */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* ........ */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* ........ */
        0x00, 0x00, 0x00, 0x00, 0x01, 0x99, 0x98, 0x6d  /* .......m */
        }
};
		
	printf("\n --------------------------ARCE GUDIÑO ANTONIO-----------------------------");

	unsigned short int size=sizeof(Trama)/sizeof*(Trama);
	for(i=0;i<size;i++)
	{
		
		//int size2=sizeof(Trama[i])/sizeof*(Trama[i]);
		printf("\n \n Trama %d",i+1);
		analizador(Trama[i]);
		/*for(j=0;j<size2;j++)
		{
			if(Trama[i][j]!=0)
			{
				printf(" %.2x",Trama[i][j]);
			}

		}*/
		

	}

	printf("\n");
	
	return 0;
}
unsigned int checksum(unsigned char *T){
	unsigned char k;
	unsigned int checkT=0;
	
	for(k=14;k<(13+((T[14]&15)*4)); k+=2)
	{
		if(k!=24)
			checkT+=(T[k]<<8)+T[k+1];
		
	}
	checkT=(checkT>>16)+(checkT & 0xFFFF);
	checkT=(~checkT)&(0xFFFF);
	return checkT;
	
}
unsigned int checksumTCP(unsigned char *T){
	unsigned char h;
	unsigned int checkTCP=0x00;
	
	//PSEUDOCABECERA
	checkTCP=(T[26]<<8 | T[27]) + (T[28]<<8 | T[29]);					//Source Address
	checkTCP+=(T[30]<<8 | T[31]) + (T[32]<<8 | T[33]);					//Destination Address
	checkTCP+=(0x00)<<8 | T[23];										//no usado 0x00 y protocolo 0x06
	checkTCP+=(0x00)<<8 | ((T[((T[14]&15)*4) + 14 + 13 -1]>>4)*4);		//tamaño en bytes TCP
	

	for(h=(((T[14]&15)*4) + 14 ); h<(14 + ((T[14]&15)*4) + ((T[(((T[14]&15)*4) + 14 + 13 - 1)]>>4)*4)); h+=2)	//toda la cabecera TCP
	{
		if(h!=(T[((T[14]&15)*4) + 14 + 17 - 1]))												//Omitir checksumTCP
			checkTCP+=(T[h]<<8)+T[h+1];
		
	}

	checkTCP=(checkTCP>>16)+(checkTCP & 0xFFFF);
	checkTCP=(~checkTCP)&(0xFFFF);
	
	return checkTCP;
} 

void analizador(unsigned char *T)
{
	unsigned short int tot=T[12]<<8 | T[13];
	unsigned char UC[][6]={"UI", "SIM", "-", "SARM", "UP", "-", "-", "SABM", "DIOC", "-", "-", "SARME", "-", "-", "-", "SABME", "SNRN", "-", "-", "RSET", "-", "-", "-", "XID", "-", "-", "-", "SNRME"};
	unsigned char UR[][6]={"UI", "RIM", "-", "DM", "-", "-", "-", "-", "RD", "-", "-", "-", "VA", "-", "-", "-", "-", "FRMR", "-", "-", "-", "-", "-", "XID", "-", "-", "-", "-"};
	unsigned char s[][5]={"RR","RNR","REJ","SRET"};
	printf("\n ---------------------------------Cabecera Ethernet -----------------------------");
	printf("\n ****MAC destino: ");
	printf(" %.2x : %.2x : %.2x : %.2x : %.2x : %.2x", T[0], T[1], T[2], T[3], T[4], T[5]); 
	printf("\n ****MAC origen: ");
	printf(" %.2x : %.2x : %.2x : %.2x : %.2x : %.2x", T[6], T[7], T[8], T[9], T[10], T[11]); 
	
	if(tot<1500){
		printf("\n Tamaño: %d  bytes", tot);
		printf("\n --------LLC------");
		switch(T[16]& 3){
			case 0:						
				printf("\n T - I,  N(s): %d,  N(r): %d,  ", T[16]>>1, T[17]>>1);
				if(T[17]&1)				
					if(T[15]&1)			
						printf("F");
					else
						printf("P ");
			break;
			case 1:						
				printf("\n T-S,  %s,  N(r): %d,  ", s[(T[16]>>2)&3], T[17]>>1);
				if(T[17]&1)				
					if(T[15]&1)			
						printf("f");
					else
						printf("p");
			break;
			case 2:						
				printf("\n T-I,  N(s): %d,  N(r): %d,  ", T[16]>>1, T[17]>>1);
				if(T[17]&1)				
					if(T[15]&1)			
						printf("f");
					else
						printf("p");
			break;
			case 3:						
                if(T[16]&16)  //P/F =1
				{
					if(T[15]&1)
					{
						printf("\n Trama -U %s, f",UR[((T[16]>>2)&3)+((T[16]>>3)&28)]);
					}
					else
					{
						printf("\n Trama -U %s, p",UC[((T[16]>>2)&3)+((T[16]>>3)&28)]);
					}
				}
			break;
		}
		
	}	
	else if(tot==2048){
		unsigned int comp=checksum(T);
		unsigned int l;
		unsigned char i=0;
		printf("\n Trama tipo IP ");
		printf("\n >>>>>>>>>>>>> CABECERA IP <<<<<<<<<<<<< \n");
		printf(" Version: %d \n", T[14]>>4);			//TIPO DE VERSION
		printf(" IHL: %d bytes \n", (T[14]&15)*4);		//IHL
		if(T[15]&16)										//T.O.S Retraso MINIMO
			printf(" Retraso minimo \n");
		if(T[15]&8)											//T.O.S Rendimiento MAXIMO
			printf(" Rendimiento Maximo \n");
		if(T[15]&4)											//T.O.S Confiabilidad MAXIMA
			printf(" Confiabilidad Maxima \n");
		if(T[15]&2)											//T.O.S Costo MINIMO
			printf(" Costo minimo \n");
		printf(" Tamanio total: %d \n", T[16]<<8 | T[17]);	//TAMAÑO TOTAL (No tiene que coincidir con el tam de la trama)
		printf(" Indentificador: %d \n", T[18]<<8 | T[19]);	//ID
		if(T[20]&64)										//Flag DF
			printf(" No se puede mas fragmentacion \n");
		else
			printf(" Si se puede fragmentar \n");
		if(T[20]&32)										//Flag MF
			printf(" Hay mas fragmentos \n");
		else
			printf(" No hay mas fragmentos \n");
		printf(" Fragment Offset: %d bytes \n", ((T[20]&31)<<8 | T[21])*8);
		printf(" TTL: %d", T[22] );

		printf("\n Checksum calculado es: %.4x",comp);
		
		if(comp==(T[24]<<8 | T[25]))
			printf("\n Checksum correcto");
		else
			printf("\n Checksum incorrecto, debe de ser: %x%x ",T[24],T[25]);

		if(((T[14]&15)*4) > 20){														//Opciones
			printf("\n Las opciones son: ");
			for(l=34; l < 34+(((T[14]&15)*4)-20); l+=4)									//impresion de opciones
				printf(" %x %x %x %x", T[l], T[l+1], T[l+2], T[l+3]);
			printf(" \n");
		}
		
	
		

		if(T[23]==1)
		{
			printf("\n >>>>>>>>>>>>>Cabecera del Protocolo ICMP <<<<<<<<<<<<< \n");
			if(T[14 + ((T[14]&15)*4)] == 0)
			{																				//Tipo de solicitud
				printf(" Tipo: Respuesta ECO \n");
				printf(" Codigo: %d \n", T[(14+((T[14]&15)*4)+1)]);														//codigo
				printf(" Checksum: %02x \n", (T[(((T[14]&15)*4) | 2)]<<8) | T[(((T[14]&15)*4) | 3)]);					//checksum
				printf(" ID: %d \n", (T[(((T[14]&15)*4)+4)]<<8)+T[(((T[14]&15)*4)+5)]);							//ID
				printf(" Numeros de secuencia: %d \n", (T[(((T[14]&15)*4)+6)]<<8)+T[(((T[14]&15)*4)+7)]);			//Numeros de secuencia
				printf(" Datos Opcionales: ");
				for(l=(((T[14]&15)*4)+8);l<192;l++)
				{
					printf("%c",T[l]);
				}

			}
			else if(T[14 + ((T[14]&15)*4)] == 3)
			{										
				printf(" Tipo: Destino Inalcanzable \n");
				printf(" Codigo: %d ", T[14 + ((T[14]&15)*4) + 1]);															//codigo
				if((T[14 + ((T[14]&15)*4) + 1]) == 0)																		//Tipo de destino
					printf(" *Red Inalcanzable* \n");
				else if((T[14 + ((T[14]&15)*4) + 1]) == 1)										
					printf(" *Host Inalcanzable* \n");
				else if((T[14 + ((T[14]&15)*4) + 1]) == 2)										
					printf(" *Protocolo Inalcanzable* \n");
				else if((T[14 + ((T[14]&15)*4) |+ 1]) == 3)										
					printf(" *Puerto Inalcanzable* \n");
				else																										//Otro tipo de destino
					printf(" *Destino inalcanzable* \n");
				printf(" Checksum: %.4x \n", T[14 | ((T[14]&15)*4) | 2]<<8 | T[14 | ((T[14]&15)*4) | 3]);					//checksum
				//siguen 4 bytes no utilizados (No se imprime)
				//Enc IP y 8 bytes del datagrama (No se imprime)
			}			
			else if(T[14 + ((T[14]&15)*4)] == 8) 
			{
				printf(" Tipo: Solicitud ECO \n");
				printf(" Codigo: %d \n", T[(14+((T[14]&15)*4)+1)]);														//codigo
				printf(" Checksum: %02x \n", (T[(((T[14]&15)*4) | 2)]<<8) | T[(((T[14]&15)*4) | 3)]);					//checksum
				printf(" ID: %d \n", (T[(((T[14]&15)*4)+4)]<<8)+T[(((T[14]&15)*4)+5)]);							//ID
				printf(" Numeros de secuencia: %d \n", (T[(((T[14]&15)*4)+6)]<<8)+T[(((T[14]&15)*4)+7)]);			//Numeros de secuencia
				printf(" Datos Opcionales: ");
				for(l=(((T[14]&15)*4)+8);l<192;l++)
				{
					printf("%c",T[l]);
				}

			}
			else if(T[14 | ((T[14]&15)*4)] == 11)
			{										
				printf(" Tipo: %d Tiempo de espera agotado \n", T[14 | ((T[14]&15)*4)]);
				printf(" Codigo: %d \n", T[14 | ((T[14]&15)*4) | 1]);														//codigo
				printf(" Checksum: %.4x \n", T[14 | ((T[14]&15)*4) | 2]<<8 | T[14 | ((T[14]&15)*4) | 3]);					//checksum
			}
			
		}
		else if(T[23]==6)
		{
			printf("\n >>>>>>>>>>>>>>>>>>>>>Cabecera del Protocolo TCP<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<\n");
			printf(" Tamanio de cabecera: %d \n", (T[(((T[14]&15)*4) + 14 + 13 - 1)]>>4)*4);								//TAM cabecera TCP
			unsigned int c=checksumTCP(T);																					//CheckSumTCP
			printf(" CheckSum TCP: %.4x \n", (T[((T[14]&15)*4) + 14 + 17 - 1]<<8) | (T[((T[14]&15)*4) + 14 + 18 - 1]));
		
			if(c==0)
				printf(" El Checksum es correcto :D \n");
			else
				printf(" Checksum correcto es: %.4x \n",c);
		}
		else if(T[23]==17){
			printf("\n ------------------------------------Cabecera del Protocolo UDP---------------------------------------");
			printf("\n >>>>>>>>>>>>> Cabecera Protocolo UDP <<<<<<<<<<<<< \n");
			printf(" Puerto Destino: %.4x \n", (T[14 + ((T[14]&15)*4)]<<8 | T[14 + ((T[14]&15)*4) + 1]));					//Puerto Destino
			printf(" Puerto Origen: %.4x \n", (T[14 + ((T[14]&15)*4) + 2]<<8 | T[14 + ((T[14]&15)*4) + 3]));				//Puerto Origen
			printf(" Tamaño: %d \n", (T[14 + ((T[14]&15)*4) + 4]<<8 | T[14 + ((T[14]&15)*4) + 5]));						//Tamaño(bytes)
			printf(" CheckSum: %.4x \n", (T[14 + ((T[14]&15)*4) + 6]<<8 | T[14 + ((T[14]&15)*4) + 7]));						//CheckSum
		}
		
		

	}
	else if(tot==2054){
		unsigned char i=0;
		unsigned char TdH[][16]={"x","Ethernet","x","x","x","x","IEEE 802 LAN"};
		unsigned char O[][18]={"x","Solicitud","Respuesta","Solicitud-Inversa","Respuesta-Inversa"};	
			
		printf("\n >>>>>>>>>>>>> CABECERA ARP <<<<<<<<<<<<< \n");
		printf(	" Tipo direccion Hadware: %s \n", TdH[(T[14]<<8) | (T[15])]);
		printf(" Tipo direccion Protocolo:");					
		if( (T[16]<<8 | T[17])==2048 )
			printf(" Direccion IPv4\n");
		printf(" Tamanio direccion Hardware: %02X \n", T[18]);
		printf(" Tamanio direccion Protocolo: %02X \n", T[19]);
		printf(" Operacion: %02X, %s \n",(T[20]<<8)|(T[21]), O[(T[20]<<8)|(T[21])]);	
		
		printf(" IP origen: %d",T[28]);
		for(i=29; i<32; i+=1)
			printf(".%d",T[i]);	
					
		printf(" IP destino: %d",T[38]);
		for(i=39; i<42; i+=1){
			printf(".%d \n",T[i]);}
		
	}
	else{
		printf("\n Otro tipo de trama.");
	}

	return;
}

